name: Build and Deploy Web App to GitHub Pages

on:
  push:
    branches: ["main"] # Trigger on pushes to the main branch
  workflow_dispatch: # Allows manual trigger from the Actions tab

# Grant GITHUB_TOKEN the necessary permissions for deployment
permissions:
  contents: read
  pages: write # Permission to deploy to GitHub Pages
  id-token: write # Permission to create and sign OIDC tokens

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      # --- Step 1: Install Dependencies & Build ---
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20' # Change this to your required Node.js version

      - name: Install and Build
        run: |
          npm install 
          npm run build # This command generates your static assets

      # --- Step 2: Upload Artifact for Deployment ---
      - name: Upload Pages Artifact
        uses: actions/upload-pages-artifact@v3
        with:
          # This is the directory created by 'npm run build'
          # COMMON FOLDERS: 'dist', 'build', 'out' - **ADJUST THIS**
          path: './dist' 

  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build # This job must wait for the 'build' job to finish
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4 # The official action for deployment
